<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Rekap Keuangan Bulanan PRO</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4e73df">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#4e73df,#1cc88a);
    padding:30px;
}
.container{max-width:1000px;margin:auto;}
.card{
    background:#fff;
    padding:25px;
    border-radius:18px;
    box-shadow:0 20px 40px rgba(0,0,0,0.15);
}
h2{margin-top:0;}
select,input{
    padding:10px;
    border-radius:8px;
    border:1px solid #ddd;
    width:100%;
}
.flex{display:flex;gap:10px;}
button{
    padding:10px 18px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
}
.primary{background:#4e73df;color:white;}
.danger{background:#e74a3b;color:white;}
.dark{background:#333;color:white;}
button:hover{opacity:0.85}
table{width:100%;margin-top:15px;border-collapse:collapse;}
th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;}
th{background:#f8f9fc;}
.summary{
    margin-top:20px;
    padding:15px;
    background:#f8f9fc;
    border-radius:12px;
    font-weight:600;
}
.no-export{display:inline-block;}
.export-mode .no-export{display:none;}
.export-mode{background:#fff!important;}
@media(max-width:600px){.flex{flex-direction:column}}
</style>
</head>
<body>

<div class="container">
<div class="card" id="areaCetak">

<h2 id="judulBulan">Rekap Keuangan</h2>

<div class="flex">
<select id="bulan"></select>
<select id="tahun"></select>
</div>

<br>

<label>Gaji Bulan Ini</label>
<input type="number" id="gaji" placeholder="Masukkan gaji">

<h3>Tambah Pengeluaran</h3>

<div class="flex">
<input type="text" id="nama" placeholder="Nama Pengeluaran (Contoh: Bayar Kontrakan)">
<select id="kategori">
<option>Tempat Tinggal (Hunian)</option>
<option>Utilitas & Energi</option>
<option>Internet & Komunikasi</option>
<option>Makanan & Konsumsi</option>
<option>Transportasi</option>
<option>Asuransi & Proteksi</option>
<option>Kesehatan</option>
<option>Pendidikan</option>
<option>Hiburan & Rekreasi</option>
<option>Kewajiban & Cicilan</option>
<option>Tabungan & Investasi</option>
<option>Belanja Kebutuhan Pribadi</option>
<option>Zakat, Infak, Sedekah & Sosial (ZIS)</option>
<option>Dana Tak Terduga / Lain-lain</option>
</select>
<input type="number" id="jumlah" placeholder="Jumlah">
<button class="primary no-export" onclick="tambah()">Tambah</button>
</div>

<table>
<thead>
<tr>
<th>Nama Pengeluaran</th>
<th>Kategori</th>
<th>Jumlah</th>
<th class="no-export">Aksi</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<div class="summary">
Total Pengeluaran: Rp <span id="total">0</span><br>
Sisa Saldo: Rp <span id="sisa">0</span>
</div>

</div>

<br>

<div class="no-export">
<button class="dark" onclick="hapusBulan()">Hapus Bulan Ini</button>
<button class="danger" onclick="resetSemua()">Reset Semua</button>
<button class="primary" onclick="exportPNG()">Export PNG</button>
<button class="primary" onclick="exportPDF()">Export PDF</button>
</div>

</div>

<script>
const bulanSelect=document.getElementById("bulan");
const tahunSelect=document.getElementById("tahun");
const list=document.getElementById("list");
let total=0;

const namaBulan=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
namaBulan.forEach((b,i)=>bulanSelect.innerHTML+=`<option value="${i}">${b}</option>`);
for(let y=2024;y<=2030;y++)tahunSelect.innerHTML+=`<option>${y}</option>`;

function keyStorage(){return `keuangan_${tahunSelect.value}_${bulanSelect.value}`;}
function format(n){return n.toLocaleString("id-ID");}

function simpan(){
    const data={gaji:document.getElementById("gaji").value,items:[]};
    document.querySelectorAll("#list tr").forEach(row=>{
        data.items.push({
            nama:row.cells[0].innerText,
            kategori:row.cells[1].innerText,
            jumlah:parseInt(row.dataset.jumlah)
        });
    });
    localStorage.setItem(keyStorage(),JSON.stringify(data));
}

function load(){
    list.innerHTML=""; total=0;
    const data=JSON.parse(localStorage.getItem(keyStorage()));
    if(!data)return;
    document.getElementById("gaji").value=data.gaji;
    data.items.forEach(i=>tambah(i.nama,i.kategori,i.jumlah,false));
    hitung();
}

function tambah(nm=null,kat=null,jml=null,save=true){
    const nama=nm||document.getElementById("nama").value;
    const kategori=kat||document.getElementById("kategori").value;
    const jumlah=jml||parseInt(document.getElementById("jumlah").value);
    if(!nama||!jumlah)return alert("Isi lengkap");

    const row=document.createElement("tr");
    row.dataset.jumlah=jumlah;
    row.innerHTML=`
    <td>${nama}</td>
    <td>${kategori}</td>
    <td>Rp ${format(jumlah)}</td>
    <td class="no-export"><button class="danger" onclick="hapus(this)">Hapus</button></td>
    `;
    list.appendChild(row);

    total+=jumlah;
    hitung();
    if(save)simpan();
    document.getElementById("nama").value="";
    document.getElementById("jumlah").value="";
}

function hapus(btn){
    total-=parseInt(btn.parentElement.parentElement.dataset.jumlah);
    btn.parentElement.parentElement.remove();
    hitung(); simpan();
}

function hitung(){
    const gaji=parseInt(document.getElementById("gaji").value)||0;
    document.getElementById("total").innerText=format(total);
    document.getElementById("sisa").innerText=format(gaji-total);
}

function hapusBulan(){
    if(confirm("Hapus data bulan ini?")){
        localStorage.removeItem(keyStorage()); location.reload();
    }
}

function resetSemua(){
    if(confirm("Reset semua data?")){
        localStorage.clear(); location.reload();
    }
}

function updateJudul(){
    document.getElementById("judulBulan").innerText=
    `Rekap Keuangan ${namaBulan[bulanSelect.value]} ${tahunSelect.value}`;
}

bulanSelect.onchange=()=>{updateJudul();load()}
tahunSelect.onchange=()=>{updateJudul();load()}
document.getElementById("gaji").oninput=()=>{hitung();simpan()}

updateJudul(); load();

async function exportPNG(){
    document.body.classList.add("export-mode");
    const canvas=await html2canvas(document.getElementById("areaCetak"));
    const link=document.createElement("a");
    link.download="rekap-keuangan.png";
    link.href=canvas.toDataURL();
    link.click();
    document.body.classList.remove("export-mode");
}

async function exportPDF(){
    document.body.classList.add("export-mode");
    const { jsPDF }=window.jspdf;
    const pdf=new jsPDF();
    const canvas=await html2canvas(document.getElementById("areaCetak"));
    const img=canvas.toDataURL("image/png");
    pdf.addImage(img,"PNG",10,10,190,0);
    pdf.save("rekap-keuangan.pdf");
    document.body.classList.remove("export-mode");
}
</script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>